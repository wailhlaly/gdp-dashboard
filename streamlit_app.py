import streamlit as st
import yfinance as yf
import pandas as pd
import numpy as np
import time

# --- ุฅุนุฏุงุฏ ุงูุตูุญุฉ ---
st.set_page_config(page_title="TASI Sniper", layout="wide")
st.title("๐ฏ ููุงุต ุงููุฑุต (RSI 30 + EMA 8 Breakout)")

# --- ุงูุฅุนุฏุงุฏุงุช ---
RSI_PERIOD = 24 # ุงููุณุชุฎุฏูุฉ ุณุงุจูุงู (ููููู ุชุนุฏูููุง ูู 14 ุฅุฐุง ุฃุฑุฏุช ุงุณุชุฌุงุจุฉ ุฃุณุฑุน ููุงุณุชุฑุงุชูุฌูุฉ)
EMA_PERIOD = 8

# --- ุงููุงุฆูุฉ ุงูุดุงููุฉ (ุฌููุน ูุทุงุนุงุช ุงูุณูู) ---
TICKERS = {
    # === ุงูุทุงูุฉ ===
    "2222.SR": "ุฃุฑุงููู", "2030.SR": "ุงููุตุงูู", "4200.SR": "ุงูุฏุฑูุณ", "5110.SR": "ุงูููุฑุจุงุก", "2080.SR": "ุงูุบุงุฒ", "4030.SR": "ุงูุจุญุฑู", "2380.SR": "ุฑุงุจุบ", "2381.SR": "ุงูุญูุฑ ุงูุนุฑุจูุฉ", "2382.SR": "ุฃุฏูุณ",
    # === ุงูููุงุฏ ุงูุฃุณุงุณูุฉ ===
    "2010.SR": "ุณุงุจู", "1211.SR": "ูุนุงุฏู", "2020.SR": "ุณุงุจู ูููุบุฐูุงุช", "2310.SR": "ุณุจููู", "2060.SR": "ุงูุชุตููุน", "2290.SR": "ููุณุงุจ", "2001.SR": "ูููุงููู", "2170.SR": "ุงููุฌูู", "2330.SR": "ุงููุชูุฏูุฉ", "2350.SR": "ููุงู", "2090.SR": "ุฌุจุณูู", "2150.SR": "ุฒุฌุงุฌ", "2180.SR": "ููุจูู", "2200.SR": "ุฃูุงุจูุจ", "2210.SR": "ููุง", "2230.SR": "ุงูููููุงุฆูุฉ", "2240.SR": "ุงูุฒุงูู", "2250.SR": "ุงููุฌููุนุฉ", "2300.SR": "ุตูุงุนุฉ ุงููุฑู", "2320.SR": "ุงูุจุงุจุทูู", "2340.SR": "ุงูุนุจุฏุงููุทูู", "2360.SR": "ุงููุฎุงุฑูุฉ", "2370.SR": "ูุณู", "3001.SR": "ุฃุณููุช ุญุงุฆู", "3002.SR": "ุฃุณููุช ูุฌุฑุงู", "3003.SR": "ุฃุณููุช ุงููุฏููุฉ", "3004.SR": "ุฃุณููุช ุงูุดูุงููุฉ", "3005.SR": "ุฃุณููุช ุฃู ุงููุฑู", "3007.SR": "ุฒูุฑุฉ ุงููุงุญุฉ", "3008.SR": "ุงููุซูุฑู", "3010.SR": "ุฃุณููุช ุงูุนุฑุจูุฉ", "3020.SR": "ุฃุณููุช ุงูููุงูุฉ", "3030.SR": "ุฃุณููุช ุงูุณุนูุฏูุฉ", "3040.SR": "ุฃุณููุช ุงููุตูู", "3050.SR": "ุฃุณููุช ุงูุฌููุจ", "3060.SR": "ุฃุณููุช ููุจุน", "3080.SR": "ุฃุณููุช ุงูุดุฑููุฉ", "3090.SR": "ุฃุณููุช ุชุจูู", "3091.SR": "ุฃุณููุช ุงูุฌูู", "1301.SR": "ุฃุณูุงู", "1304.SR": "ุงูููุงูุฉ ููุญุฏูุฏ", "1320.SR": "ุฃูุงุจูุจ ุงูุดุฑู", "1321.SR": "ุฃูุงุจูุจ ุงูุณุนูุฏูุฉ", "1322.SR": "ุงููุทุงุญู ุงูุฃููู",
    # === ุงูุจููู ูุงูุชูููู ===
    "1120.SR": "ุงูุฑุงุฌุญู", "1180.SR": "ุงูุฃููู", "1010.SR": "ุงูุฑูุงุถ", "1150.SR": "ุงูุฅููุงุก", "1060.SR": "ุงูุฃูู", "1140.SR": "ุงูุจูุงุฏ", "1030.SR": "ุงูุงุณุชุซูุงุฑ", "1020.SR": "ุงูุฌุฒูุฑุฉ", "1080.SR": "ุงูุนุฑุจู", "1050.SR": "ุงููุฑูุณู", "1111.SR": "ุชุฏุงูู", "1182.SR": "ุฃููุงู", "1183.SR": "ุณูู", "4081.SR": "ุงููุงููุงุช", "4280.SR": "ุงูููููุฉ",
    # === ุงูุณูุน ุงูุฑุฃุณูุงููุฉ ูุงูุฎุฏูุงุช ===
    "1201.SR": "ุชูููู", "1202.SR": "ูุจูู", "1210.SR": "ุจู ุณู ุขู", "1212.SR": "ุฃุณุชุฑุง", "1214.SR": "ุดุงูุฑ", "1302.SR": "ุจูุงู", "1303.SR": "ุงูุตูุงุนุงุช ุงูููุฑุจุงุฆูุฉ", "1831.SR": "ููุงุฑุฉ", "1832.SR": "ุตุฏุฑ", "2040.SR": "ุงูุฎุฒู", "2110.SR": "ุงููุงุจูุงุช", "2140.SR": "ุงูุฃุญุณุงุก", "2390.SR": "ุฃุณูุฌ", "4020.SR": "ุงูุนูุงุฑูุฉ", "4040.SR": "ุงูุฌูุงุนู", "4050.SR": "ุณุงุณูู", "4070.SR": "ุชูุงูุฉ", "4110.SR": "ุจุงุชู", "4140.SR": "ุงูุตุงุฏุฑุงุช", "4141.SR": "ุงูุนูุฑุงู", "4142.SR": "ุงูุฑูุงุถ ููุญุฏูุฏ",
    # === ุงูุฎุฏูุงุช ุงูุชุฌุงุฑูุฉ ูุงูููููุฉ ===
    "1810.SR": "ุณูุฑุง", "1820.SR": "ูุฌููุนุฉ ุงูุญููุฑ", "1830.SR": "ููุช ุงูููุงูุฉ", "1833.SR": "ุงูููุงุฑุฏ", "4260.SR": "ุจุฏุฌุช", "4261.SR": "ุฐูุจ", "4262.SR": "ูููู", "4080.SR": "ุณูุงุฏ", "6004.SR": "ุงูุชูููู", "6012.SR": "ุฑูุฏุงู", 
    # === ุงูููู ===
    "4031.SR": "ุงูุฎุฏูุงุช ุงูุฃุฑุถูุฉ", "4263.SR": "ุณุงู",
    # === ุงูุณูุน ุทูููุฉ ุงูุฃุฌู ===
    "4011.SR": "ูุงุฒูุฑุฏู", "4012.SR": "ุฃุตูู", "4014.SR": "ุชูููุฉ",
    # === ุงูุฎุฏูุงุช ุงูุงุณุชููุงููุฉ ===
    "1834.SR": "ูุฑุงูู", "2190.SR": "ุณูุณูู", "4003.SR": "ุฅูุณุชุฑุง", "4008.SR": "ุณุงูู", "4161.SR": "ุจู ุฏุงูุฏ", "4162.SR": "ุงูููุฌู", "4163.SR": "ุงูุฏูุงุก", "4164.SR": "ุงูููุฏู", "4190.SR": "ุฌุฑูุฑ", "4191.SR": "ุงูุณูู ุบุงููุฑู", "4001.SR": "ุงูุนุซูู", "4006.SR": "ุงููุฒุฑุนุฉ", "4061.SR": "ุฃูุนุงู", "4100.SR": "ููุฉ", "4170.SR": "ุดูุณ", "4180.SR": "ูุชูุญู", "4290.SR": "ุงูุฎููุฌ ููุชุฏุฑูุจ", "4291.SR": "ุงููุทููุฉ ููุชุนููู", "4292.SR": "ุนุทุงุก", "6001.SR": "ุญููุงูู", "6002.SR": "ูุฑูู", "2270.SR": "ุณุฏุงููู", "2280.SR": "ุงููุฑุงุนู", "6010.SR": "ูุงุฏู", "6020.SR": "ุฌุงูู", "6040.SR": "ุชุจูู ุงูุฒุฑุงุนูุฉ", "6050.SR": "ุงูุฃุณูุงู", "6060.SR": "ุงูุดุฑููุฉ ุงูุฒุฑุงุนูุฉ", "6070.SR": "ุงูุฌูู", "6090.SR": "ุฌุงุฒุงุฏูู",
    # === ุงูุฑุนุงูุฉ ุงูุตุญูุฉ ===
    "4002.SR": "ุงูููุงุณุงุฉ", "4004.SR": "ุฏูุฉ", "4005.SR": "ุฑุนุงูุฉ", "4007.SR": "ุงูุญูุงุฏู", "4009.SR": "ุงูุฃููุงูู", "4013.SR": "ุณูููุงู ุงูุญุจูุจ", "4015.SR": "ุฌูุฌูู ูุงุฑูุง",
    # === ุงูุชุฃููู ===
    "8010.SR": "ุงูุชุนุงูููุฉ", "8012.SR": "ุฌุฒูุฑุฉ ุชูุงูู", "8020.SR": "ููุงุฐ", "8030.SR": "ููุฏุบูู", "8040.SR": "ุฃููุงูุฒ", "8050.SR": "ุณูุงูุฉ", "8060.SR": "ููุงูุก", "8070.SR": "ุงูุฏุฑุน ุงูุนุฑุจู", "8100.SR": "ุณุงููู", "8120.SR": "ุงุชุญุงุฏ ุงูุฎููุฌ", "8150.SR": "ุฃุณูุฌ", "8160.SR": "ุงูุชุฃููู ุงูุนุฑุจูุฉ", "8170.SR": "ุงูุงุชุญุงุฏ", "8180.SR": "ุงูุตูุฑ", "8190.SR": "ุงููุชุญุฏุฉ", "8200.SR": "ุฅุนุงุฏุฉ", "8210.SR": "ุจูุจุง", "8230.SR": "ุงูุฑุงุฌุญู ุชูุงูู", "8240.SR": "ุชุดุจ", "8250.SR": "ุฌู ุฌู", "8260.SR": "ุงูุฎููุฌูุฉ", "8270.SR": "ุจุฑูุฌ", "8280.SR": "ุงูุนุงูููุฉ", "8300.SR": "ุงููุทููุฉ", "8310.SR": "ุฃูุงูุฉ", "8311.SR": "ุนูุงูุฉ", "8312.SR": "ุงูุฅููุงุก ุทูููู",
    # === ุงูุงุชุตุงูุงุช ูุชูููุฉ ุงููุนูููุงุช ===
    "7010.SR": "STC", "7020.SR": "ููุจุงููู", "7030.SR": "ุฒูู", "7040.SR": "ุนุฐูุจ", "7200.SR": "ุณููุดูุฒ", "7201.SR": "ุจุญุฑ ุงูุนุฑุจ", "7202.SR": "ุนูู", "7203.SR": "ุชูุจู",
    # === ุงูุนูุงุฑุงุช ูุงูุฑูุช ===
    "4090.SR": "ุทูุจุฉ", "4150.SR": "ุงูุชุนููุฑ", "4220.SR": "ุฅุนูุงุฑ", "4230.SR": "ุงูุจุญุฑ ุงูุฃุญูุฑ", "4240.SR": "ุงูุญููุฑ", "4250.SR": "ุฌุจู ุนูุฑ", "4300.SR": "ุฏุงุฑ ุงูุฃุฑูุงู", "4310.SR": "ูุฏููุฉ ุงููุนุฑูุฉ", "4320.SR": "ุงูุฃูุฏูุณ", "4321.SR": "ุงููุฑุงูุฒ", "4322.SR": "ุฑุชุงู", "4323.SR": "ุณูู",
    "4330.SR": "ุงูุฑูุงุถ ุฑูุช", "4331.SR": "ุงูุฌุฒูุฑุฉ ุฑูุช", "4332.SR": "ุฌุฏูู ุฑูุช ุงูุญุฑููู", "4333.SR": "ุชุนููู ุฑูุช", "4334.SR": "ุงููุนุฐุฑ ุฑูุช", "4335.SR": "ูุดุงุฑูุฉ ุฑูุช", "4336.SR": "ููููุงุช ุฑูุช", "4337.SR": "ุณุฏูู ูุงุจูุชุงู ุฑูุช", "4338.SR": "ุงูุฃููู ุฑูุช 1", "4339.SR": "ุฏุฑุงูุฉ ุฑูุช", "4340.SR": "ุงูุฑุงุฌุญู ุฑูุช", "4342.SR": "ุฌุฏูู ุฑูุช ุงูุณุนูุฏูุฉ", "4344.SR": "ุณุฏูู ูุงุจูุชุงู", "4345.SR": "ุงูุฅููุงุก ุฑูุช", "4346.SR": "ูููู ุฑูุช", "4347.SR": "ุจููุงู ุฑูุช", "4348.SR": "ุงูุฎุจูุฑ ุฑูุช", 
    # === ุงููุคุดุฑ ===
    "^TASI.SR": "ุงููุคุดุฑ ุงูุนุงู"
}

# --- ุงูุฏูุงู ุงููููุฉ ---
def calculate_rsi_rma(series, period):
    delta = series.diff()
    gain = delta.clip(lower=0)
    loss = -delta.clip(upper=0)
    avg_gain = gain.ewm(alpha=1/period, min_periods=period, adjust=False).mean()
    avg_loss = loss.ewm(alpha=1/period, min_periods=period, adjust=False).mean()
    rs = avg_gain / avg_loss
    rsi = 100 - (100 / (1 + rs))
    return rsi

def calculate_ema(series, period):
    return series.ewm(span=period, adjust=False).mean()

# --- ุงูุฐุงูุฑุฉ ---
if 'summary' not in st.session_state:
    st.session_state['summary'] = []
if 'signals' not in st.session_state:
    st.session_state['signals'] = []
if 'market_data' not in st.session_state:
    st.session_state['market_data'] = {}

# --- ุงููุงุฌูุฉ ูุงูุฒุฑ ---
col_btn, col_info = st.columns([1, 4])
with col_btn:
    start_btn = st.button('๐ ูุญุต ุงูุฅุดุงุฑุงุช ุงููููุฉ')
with col_info:
    st.caption("ุณูุชู ุงูุจุญุซ ุนู: ุงุฎุชุฑุงู RSI 30 ููุฃุนูู + ุงุฎุชุฑุงู ุงูุณุนุฑ ูู EMA 8 (ูู ุขุฎุฑ 3 ุฃูุงู ููุท).")

# --- ููุทู ุงูุชุญููู ูุงูุชุญููู ---
if start_btn:
    st.session_state['summary'] = []
    st.session_state['signals'] = []
    st.session_state['market_data'] = {}
    
    tickers_list = list(TICKERS.keys())
    total_tickers = len(tickers_list)
    chunk_size = 50 
    
    status_box = st.empty()
    progress_bar = st.progress(0)
    
    for i in range(0, total_tickers, chunk_size):
        chunk = tickers_list[i:i + chunk_size]
        status_box.text(f"ุฌุงุฑู ูุณุญ ุงูุฏูุนุฉ {i//chunk_size + 1}...")
        
        try:
            # ุชุญููู ุจูุงูุงุช ูุงููุฉ (6 ุดููุฑ) ููุชุฃูุฏ ูู ุฏูุฉ ุงููุชูุณุทุงุช
            data_chunk = yf.download(chunk, period="6mo", interval="1d", group_by='ticker', auto_adjust=False, threads=True, progress=False)
            
            if not data_chunk.empty:
                for symbol in chunk:
                    try:
                        name = TICKERS[symbol]
                        
                        try:
                            df = data_chunk[symbol].copy()
                        except KeyError:
                            continue

                        # ุชูุญูุฏ ุงูุนููุฏ
                        target_col = None
                        if 'Close' in df.columns: target_col = 'Close'
                        elif 'Adj Close' in df.columns: target_col = 'Adj Close'
                        
                        if target_col:
                            series = df[target_col].dropna()
                            
                            if len(series) > 50:
                                # ุญุณุงุจ ุงููุคุดุฑุงุช
                                rsi = calculate_rsi_rma(series, RSI_PERIOD)
                                ema8 = calculate_ema(series, EMA_PERIOD)
                                
                                df['RSI'] = rsi
                                df['EMA8'] = ema8
                                df['Close_Clean'] = series
                                st.session_state['market_data'][name] = df # ุญูุธ ููุชูุงุตูู

                                # --- ุงูููุฎุต ุงูุนุงู (ุงูุฌุฏูู ุงููุจูุฑ) ---
                                last_rsi = rsi.iloc[-1]
                                last_price = series.iloc[-1]
                                
                                if not np.isnan(last_rsi):
                                    st.session_state['summary'].append({
                                        "ุงูุงุณู": name,
                                        "ุงูุณุนุฑ": last_price,
                                        f"RSI ({RSI_PERIOD})": last_rsi
                                    })
                                
                                # --- ุฎูุงุฑุฒููุฉ ูุดู ุงูุงุฎุชุฑุงูุงุช (ุงููุงุฆูุฉ ุงูุฐูุจูุฉ) ---
                                # ูุญุชุงุฌ ูุญุต ุขุฎุฑ 3 ุดูุนุงุช (ุงูุฃุฎูุฑุฉ -1ุ ูุจููุง -2ุ ูุจููุง -3)
                                # ุงูุงุฎุชุฑุงู ูุนูู: ุงููููุฉ ุงูุณุงุจูุฉ ูุงูุช ุชุญุช/ุชุณุงููุ ูุงูุญุงููุฉ ููู.
                                
                                signal_detected = False
                                signal_msg = []
                                
                                # ูุฃุฎุฐ ุขุฎุฑ 4 ุตููู ููุชููู ูู ููุงุฑูุฉ (ุงูููู ูุน ุฃูุณ) ูุขุฎุฑ 3 ุฃูุงู
                                tail = df.tail(4)
                                
                                # ูุชุฃูุฏ ุฃู ูุฏููุง ุจูุงูุงุช ูุงููุฉ ูููุญุต
                                if len(tail) == 4:
                                    rsi_breakout = False
                                    ema_breakout = False
                                    
                                    # ุญููุฉ ุชูุญุต ุงูุฃูุงู ุงูุซูุงุซุฉ ุงูุฃุฎูุฑุฉ (ูุคุดุฑ 1ุ 2ุ 3 ูู ุงูุฐูู)
                                    # 1=ูุจู ูููููุ 2=ุฃูุณุ 3=ุงูููู
                                    for idx in range(1, 4):
                                        # ูุญุต RSI (ูุงู ุชุญุช 30 ูุตุงุฑ ููู)
                                        if tail['RSI'].iloc[idx-1] <= 30 and tail['RSI'].iloc[idx] > 30:
                                            rsi_breakout = True
                                        
                                        # ูุญุต EMA8 (ุงูุณุนุฑ ูุงู ุชุญุชู ูุตุงุฑ ูููู)
                                        if tail['Close_Clean'].iloc[idx-1] <= tail['EMA8'].iloc[idx-1] and tail['Close_Clean'].iloc[idx] > tail['EMA8'].iloc[idx]:
                                            ema_breakout = True
                                    
                                    # ุงูุดุฑุท ุงูููุงุฆู: ูู ุญุฏุซ ููุงููุง ุฎูุงู ุงููุงูุฐุฉ ุงูุฒูููุฉุ
                                    # ููุงุญุธุฉ: ูุฏ ูุญุฏุซุงู ูู ููุณ ุงูููู ุฃู ุฃูุงู ูุฎุชููุฉุ ุงูููู ุฃูููุง "ุทุงุฒุฌูู"
                                    if rsi_breakout and ema_breakout:
                                        st.session_state['signals'].append({
                                            "ุงูุงุณู": name,
                                            "ุงูุฑูุฒ": symbol,
                                            "ุงูุณุนุฑ": last_price,
                                            "RSI": last_rsi,
                                            "ุญุงูุฉ ุงูุฅุดุงุฑุฉ": "๐ฅ ุฏุฎูู (ุงุฎุชุฑุงู ูุฒุฏูุฌ)"
                                        })

                    except Exception as inner_e:
                        continue
                        
        except Exception as e:
            pass
        
        progress_bar.progress(min((i + chunk_size) / total_tickers, 1.0))
        time.sleep(0.2)

    progress_bar.empty()
    status_box.success("ุชู ุงููุณุญ!")

# --- ุงูุนุฑุถ ---

# 1. ุงููุงุฆูุฉ ุงูุฐูุจูุฉ (ุงูุฅุดุงุฑุงุช) - ุชุธูุฑ ูู ุงูุฃุนูู
if st.session_state['signals']:
    st.markdown("### ๐ฅ ุงูุฃุณูู ุงูุฐูุจูุฉ (ุญููุช ุงูุดุฑูุท ูู ุขุฎุฑ 3 ุฃูุงู)")
    st.info("ูุฐู ุงูุฃุณูู ุงุฎุชุฑูุช ุฎุท 30 ูู RSI **ู** ุงุฎุชุฑูุช ูุชูุณุท EMA 8 ูุคุฎุฑุงู.")
    
    df_signals = pd.DataFrame(st.session_state['signals'])
    st.dataframe(df_signals, use_container_width=True)
else:
    if start_btn: # ุฅุฐุง ุถุบุท ุงูุฒุฑ ููู ูุฌุฏ ุดูุก
        st.warning("ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃุณูู ุญููุช ุดุฑูุท ุงูุงุฎุชุฑุงู ุงููุฒุฏูุฌ ูู ุขุฎุฑ 3 ุฃูุงู.")

st.divider()

# 2. ุงูุฌุฏูู ุงูุดุงูู (ุงูููุฎุต)
if st.session_state['summary']:
    st.subheader("๐ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุณูู")
    
    df_sum = pd.DataFrame(st.session_state['summary'])
    df_sum = df_sum.sort_values(by=f"RSI ({RSI_PERIOD})", ascending=False)
    
    def highlight_rsi(val):
        bg = ''
        color = '#333333'
        weight = 'normal'
        if val >= 70:
            bg = '#8B0000'; color = 'white'; weight = 'bold'
        elif val <= 30:
            bg = '#006400'; color = 'white'; weight = 'bold'
        return f'color: {color}; font-weight: {weight}; background-color: {bg}' if bg else f'color: {color}'

    st.dataframe(
        df_sum.style.map(highlight_rsi, subset=[f"RSI ({RSI_PERIOD})"])
                  .format({"ุงูุณุนุฑ": "{:.2f}", f"RSI ({RSI_PERIOD})": "{:.2f}"}),
        use_container_width=True,
        height=400
    )
    
    # 3. ุงูุชูุงุตูู ุงูุชูุงุนููุฉ
    st.divider()
    col_sel, _ = st.columns([1, 2])
    with col_sel:
        st.subheader("๐ ูุญุต ุงูุดุงุฑุช ุงูุฑููู")
        sel = st.selectbox("ุงุฎุชุฑ ุงูุณูู:", [d['ุงูุงุณู'] for d in st.session_state['summary']])
    
    if sel:
        df_det = st.session_state['market_data'][sel]
        last_10 = df_det.tail(10).sort_index(ascending=False)
        
        # ุชุฌููุฒ ุงูุนุฑุถ
        display = last_10[['Close_Clean', 'EMA8', 'RSI']].copy()
        display = display.rename(columns={'Close_Clean': 'Close'})
        
        st.write(f"ุจูุงูุงุช **{sel}** (ุขุฎุฑ 10 ุฃูุงู):")
        
        # ุชูููู ุฎุงุต ููุชูุงุตูู ููุถุญ ุงูุชูุงุทุนุงุช
        def highlight_cross(row):
            styles = [''] * len(row)
            # ุฅุฐุง ุงูุณุนุฑ ููู EMA ููู ุฃุฎุถุฑ
            if row['Close'] > row['EMA8']:
                styles[0] = 'color: green; font-weight: bold'
            else:
                styles[0] = 'color: red'
            
            # RSI
            if row['RSI'] > 30 and row['RSI'] < 70:
                styles[2] = 'color: black'
            elif row['RSI'] <= 30:
                styles[2] = 'color: green; font-weight: bold' # ุชุดุจุน ุจูุนู
            elif row['RSI'] >= 70:
                styles[2] = 'color: red; font-weight: bold' # ุชุดุจุน ุดุฑุงุฆู
                
            return styles

        st.dataframe(
            display.style.apply(highlight_cross, axis=1)
                   .format("{:.2f}"),
            use_container_width=True
        )
